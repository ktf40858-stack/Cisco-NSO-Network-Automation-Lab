! NSO DNS Service Template Configuration
! DNS and domain configuration services for lab environment

! ====================================
! DNS TEMPLATE FOR NX-OS
! ====================================

devices template SET-DNS-SERVER
 ned-id cisco-nx-cli-5.23
 config
  ip name-server servers 208.67.222.222
  ip name-server servers 208.67.220.220
 !
!

! ====================================
! DNS TEMPLATE FOR IOS
! ====================================

devices template SET-DNS-SERVER-IOS
 ned-id cisco-ios-cli-6.91
 config
  ip name-server 208.67.222.222
  ip name-server 208.67.220.220
  ip domain-name lab.local
 !
!

! ====================================
! DNS TEMPLATE FOR IOS-XR
! ====================================

devices template SET-DNS-SERVER-XR
 ned-id cisco-iosxr-cli-7.45
 config
  domain name-server 208.67.222.222
  domain name-server 208.67.220.220
  domain name lab.local
 !
!

! ====================================
! DNS SERVICE CONFIGURATIONS
! ====================================

! OpenDNS Configuration Service
services dns-config opendns
 device-group ALL
 primary-dns 208.67.222.222
 secondary-dns 208.67.220.220
 domain-name lab.local
!

! Google DNS Configuration Service
services dns-config google
 device-group ALL
 primary-dns 8.8.8.8
 secondary-dns 8.8.4.4
 domain-name lab.local
!

! Cloudflare DNS Configuration Service
services dns-config cloudflare
 device-group ALL
 primary-dns 1.1.1.1
 secondary-dns 1.0.0.1
 domain-name lab.local
!

! Internal Lab DNS Service
services dns-config internal-lab
 device-group ALL
 primary-dns 10.10.20.10
 secondary-dns 10.10.20.11
 tertiary-dns 208.67.222.222
 domain-name lab.local
 domain-search lab.local dev.local test.local
!

! ====================================
! DIRECT DEVICE DNS CONFIGURATIONS
! ====================================

! Apply OpenDNS to NX-OS device
devices device dev-dist-sw01 apply-template template-name SET-DNS-SERVER

! DNS configuration for IOS devices
devices device edge-sw01 config
 ip name-server 208.67.222.222
 ip name-server 208.67.220.220
 ip domain-name lab.local
 ip domain-lookup
!

devices device dist-rtr01 config
 ip name-server 208.67.222.222
 ip name-server 208.67.220.220
 ip domain-name lab.local
 ip domain-lookup
!

devices device dev-dist-rtr01 config
 ip name-server 208.67.222.222
 ip name-server 208.67.220.220
 ip domain-name lab.local
 ip domain-lookup
!

! DNS configuration for IOS-XR devices
devices device core-rtr01 config
 domain name-server 208.67.222.222
 domain name-server 208.67.220.220
 domain name lab.local
!

devices device dev-core-rtr01 config
 domain name-server 208.67.222.222
 domain name-server 208.67.220.220
 domain name lab.local
!

! ====================================
! DNS FORWARDER SERVICE
! ====================================

services dns-forwarder lab-forwarder
 device-group L3-ROUTING
 listen-interface all
 forward-to 208.67.222.222
 forward-to 208.67.220.220
 cache-size 2000
 cache-ttl 7200
!

! ====================================
! LOCAL DNS RECORDS
! ====================================

services local-dns-records lab-records
 device-group ALL
 record nso-server.lab.local
  type A
  value 10.10.20.100
 !
 record ntp.lab.local
  type A
  value 10.10.20.20
 !
 record syslog.lab.local
  type A
  value 10.10.20.30
 !
 record radius.lab.local
  type A
  value 10.10.20.40
 !
 record tacacs.lab.local
  type A
  value 10.10.20.41
 !
 record snmp.lab.local
  type A
  value 10.10.20.50
 !
!

! ====================================
! DNS SECURITY CONFIGURATION
! ====================================

services dns-security dnssec
 device-group ALL
 enable-validation true
 enable-dnssec true
 validation-failure-action log
!

! ====================================
! DNS LOAD BALANCING
! ====================================

services dns-load-balancer lab-dns-lb
 device-group L3-ROUTING
 vip 10.10.20.200
 backend-server 10.10.20.10
 backend-server 10.10.20.11
 backend-server 10.10.20.12
 method round-robin
 health-check dns
 health-check-query nso-server.lab.local
!